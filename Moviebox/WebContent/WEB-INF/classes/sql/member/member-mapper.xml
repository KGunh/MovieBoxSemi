<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

	<comment>
		Member Mapper
	</comment>
	
	<entry key="login">
		 SELECT
	            MEMBER_NO,
	            MEMBER_ID,	
	            MEMBER_PWD,	
	            MEMBER_NAME,	
	            BIRTHDAY,	
	            GENDER,	
	            EMAIL,	
	            PHONE,	
	            ADDRESS,	
	            ENROLL_DATE,	
	            STATUS,	
	            PRIVILEGE,	
	            LOCATION_NAME
	   	   FROM
	            TB_MEMBER
	       JOIN
                TB_LOCATION ON(LOCAL_CODE = LOCATION_CODE)
	      WHERE
	            MEMBER_ID = ?
	        AND
	            MEMBER_PWD = ?
	        AND
	            STATUS = 'Y'

	</entry>
	
	<entry key="loginGenre">
		SELECT
                GENRE_NAME
	   	   FROM
	            TB_MEMBER
           JOIN
                TB_MEMBERGENRE ON(MEMBER_NO = MEM_NO)
           JOIN
                TB_GENRE USING(GENRE_CODE)
          WHERE
	            MEMBER_ID = ?
	        AND
	            MEMBER_PWD = ?
	        AND
	            STATUS = 'Y'
	
	
	</entry>
	
	
	<entry key="memberInsert">
		INSERT
  	      INTO
       		   TB_MEMBER(MEMBER_NO,MEMBER_ID,MEMBER_PWD,MEMBER_NAME,BIRTHDAY,GENDER,EMAIL,PHONE,ADDRESS,LOCAL_CODE)
		VALUES 
			   (SEQ_MEMNO.NEXTVAL,?,?,?,?,?,?,?,?,?)
	
	</entry>
	
	
	<entry key="genreInsert">
		INSERT
   		  INTO
       		   TB_MEMBERGENRE
	    VALUES(
	    		SEQ_MEMNO.CURRVAL,
	    		(SELECT
       				    GENRE_CODE
 				   FROM
       				    TB_GENRE
 				   WHERE
       					 GENRE_NAME = ?))
	
	</entry>
	
	<entry key="myPageMoviePrint">
		SELECT
       			   TICKET_NO,
       			   PERSONNEL,
       	     	   MEMBER_NO,
       			   MOVIE_TITLE,
       			   THEATER_NAME,
       		       TO_CHAR(WATCH_DATE,'YY/MM/DD, HH24:MI'),
       			   TB_RESERVATION.STATUS,
       			   GRADE_1_COUNT,
       		       GRADE_2_COUNT
  	      FROM
       			   TB_RESERVATION
  		   JOIN
       			   TB_SCREEN USING(SCREEN_NO)
           JOIN
                   TB_MOVIE USING(MOVIE_NO)
           JOIN
       			   TB_THEATER USING(THEATER_NO)
  		   JOIN
       				(SELECT
         				 		TICKET_NO,
         						COUNT(CASE WHEN GRADE = 1 THEN 1 ELSE NULL END) AS GRADE_1_COUNT,
         						COUNT(CASE WHEN GRADE = 2 THEN 1 ELSE NULL END) AS GRADE_2_COUNT
     				   FROM
         						TB_RESERVATION
     					JOIN
         						TB_PRICESHEET USING(TICKET_NO)
     				 WHERE
         						MEMBER_NO = ?
     			 	 GROUP 
     			 		  BY
     			                TICKET_NO) USING(TICKET_NO)
 		WHERE
       				MEMBER_NO = ?
	
	</entry>
	
</properties>
